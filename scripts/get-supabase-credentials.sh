#!/bin/bash

# üîê GUIA DEFINITIVO: Como Obter String de Conex√£o Correta do Supabase

echo "========================================================================"
echo "üîê GUIA: Como Obter Connection String Correta do Supabase"
echo "========================================================================"
echo ""
echo "O erro 'Tenant or user not found' indica que:"
echo "  1. Projeto pode estar PAUSADO"
echo "  2. Credenciais podem estar incorretas"
echo "  3. String de conex√£o pode estar no formato errado"
echo ""
echo "========================================================================"
echo "üìã PASSO A PASSO PARA RESOLVER:"
echo "========================================================================"
echo ""

echo "1Ô∏è‚É£ ACESSE O SUPABASE DASHBOARD"
echo "   Link direto: https://app.supabase.com/project/vfhzimozqsbdqknkncny"
echo ""

echo "2Ô∏è‚É£ VERIFIQUE SE O PROJETO EST√Å ATIVO"
echo "   ‚ùå Se ver mensagem 'Project paused' ou 'Inactive'"
echo "   ‚úÖ Clique em 'Resume project' ou 'Restore project'"
echo "   ‚è≥ Aguarde 2-3 minutos"
echo ""

echo "3Ô∏è‚É£ OBTER CONNECTION STRING CORRETA"
echo "   üìç No dashboard, v√° em:"
echo "      Settings ‚Üí Database"
echo ""
echo "   üìã Role at√© 'Connection string'"
echo "   üìã Selecione 'URI' (n√£o 'Connection parameters')"
echo "   üìã Mode: Selecione 'Session' (recomendado para Chatwoot)"
echo ""
echo "   üìù A string deve estar no formato:"
echo "      postgresql://postgres.vfhzimozqsbdqknkncny:[PASSWORD]@aws-0-sa-east-1.pooler.supabase.com:5432/postgres"
echo ""
echo "   ‚ö†Ô∏è  COPIE EXATAMENTE como aparece no dashboard!"
echo ""

echo "4Ô∏è‚É£ VERIFICAR SENHA DO DATABASE"
echo "   üìç Ainda em Settings ‚Üí Database"
echo "   üìã Role at√© 'Database password'"
echo ""
echo "   üîë Senhas tentadas:"
echo "      ‚ùå TqgcYbFD5EKGAQuo (antiga - n√£o funcionou)"
echo "      ‚ùå fh8eIGFps5xpVE0g (nova - n√£o funcionou)"
echo ""
echo "   üí° OP√á√ïES:"
echo "      A) Copie a senha atual exibida no dashboard"
echo "      B) OU clique em 'Reset database password'"
echo "         - Copie a NOVA senha (s√≥ aparece uma vez!)"
echo "         - Anote em local seguro"
echo ""

echo "5Ô∏è‚É£ TESTAR CONEX√ÉO MANUALMENTE"
echo "   Execute este comando substituindo [PASSWORD]:"
echo ""
echo "   docker run --rm postgres:15-alpine psql \\"
echo '     "postgresql://postgres.vfhzimozqsbdqknkncny:[PASSWORD]@aws-0-sa-east-1.pooler.supabase.com:5432/postgres?sslmode=require" \'
echo '     -c "SELECT version();"'
echo ""

echo "========================================================================"
echo "üéØ FORMATOS DE CONNECTION STRING V√ÅLIDOS:"
echo "========================================================================"
echo ""

echo "üìç OP√á√ÉO 1: Session Mode (RECOMENDADO)"
echo "postgresql://postgres.vfhzimozqsbdqknkncny:[PASSWORD]@aws-0-sa-east-1.pooler.supabase.com:5432/postgres?sslmode=require&prepared_statements=false"
echo ""

echo "üìç OP√á√ÉO 2: Transaction Mode"
echo "postgresql://postgres.vfhzimozqsbdqknkncny:[PASSWORD]@aws-0-sa-east-1.pooler.supabase.com:6543/postgres?sslmode=require&prepared_statements=false"
echo ""

echo "üìç OP√á√ÉO 3: Conex√£o Direta (sem pooler)"
echo "postgresql://postgres:[PASSWORD]@db.vfhzimozqsbdqknkncny.supabase.co:5432/postgres?sslmode=require&prepared_statements=false"
echo ""

echo "‚ö†Ô∏è  Substitua [PASSWORD] pela senha CORRETA do dashboard!"
echo ""

echo "========================================================================"
echo "üÜò CHECKLIST DE VERIFICA√á√ÉO NO SUPABASE:"
echo "========================================================================"
echo ""
echo "  [ ] Projeto est√° ATIVO (n√£o pausado)"
echo "  [ ] Database password est√° correta"
echo "  [ ] Connection string copiada do dashboard"
echo "  [ ] SSL est√° habilitado (sslmode=require)"
echo "  [ ] Regi√£o est√° correta (sa-east-1)"
echo "  [ ] Porta est√° correta (5432 ou 6543)"
echo ""

echo "========================================================================"
echo "üìû INFORMA√á√ïES DO SEU PROJETO:"
echo "========================================================================"
echo ""
echo "Project Reference: vfhzimozqsbdqknkncny"
echo "Project URL: https://vfhzimozqsbdqknkncny.supabase.co"
echo "Dashboard: https://app.supabase.com/project/vfhzimozqsbdqknkncny"
echo "Regi√£o Esperada: sa-east-1 (S√£o Paulo, AWS)"
echo ""

echo "========================================================================"
echo "üéØ PR√ìXIMOS PASSOS:"
echo "========================================================================"
echo ""
echo "1. Acesse o dashboard do Supabase (link acima)"
echo "2. Verifique se o projeto est√° ativo"
echo "3. Copie a connection string EXATA do dashboard"
echo "4. Anote a senha do database"
echo "5. Me envie:"
echo "   - Status do projeto (ativo/pausado)"
echo "   - Connection string completa do dashboard"
echo "   - Senha do database"
echo ""
echo "üí° Com essas informa√ß√µes corretas, conseguiremos fazer funcionar!"
echo ""
echo "========================================================================"